<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Profile</title>

  <!-- Third party CSS source for header-->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.0-beta2/dist/css/bootstrap.min.css" rel="stylesheet"
    integrity="sha384-BmbxuPwQa2lc/FVzBcNJ7UAyJxM6wuqIj61tLrc4wSX0szH/Ev+nYRRuWlolflfl" crossorigin="anonymous">

  <link type="text/css" rel="stylesheet" href="styles/viewprofile.css" />
  <link rel="stylesheet" href="https://fonts.googleapis.com/icon?family=Material+Icons">

</head>

<body>
  <nav class="navbar navbar-expand-lg navbar-light bg-info">
    <div class="container-fluid">
      <a class="navbar-brand" href="#">Logo</a>
      <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav"
        aria-controls="navbarNav" aria-expanded="false" aria-label="Toggle navigation">
        <span class="navbar-toggler-icon"></span>
      </button>
      <div class="collapse navbar-collapse" id="navbarNav">
        <ul class="navbar-nav">
          <li class="nav-item">
            <a class="nav-link active" aria-current="page" href="profile.html">Profile</a>
          </li>
          <li class="nav-item">
            <a class="nav-link" href="#">About</a>
          </li>
          <li class="nav-item">
            <a class="nav-link" href="settings.html">Settings</a>
          </li>
          <li class="nav-item">
            <a class="nav-link" href="#">Logout</a>
          </li>
        </ul>
      </div>
    </div>
  </nav>
  <nav class="navbar navbar-expand-lg navbar-light bg-white">
    <div class="container-fluid justify-content-evenly">
      <a href="home.html" class="home" style="color: black;">
        <span class="material-icons" style="font-size: 45px;">
          home
        </span>
      </a>
      <a href="connect.html" class="home" style="color: black;">
        <span class="material-icons" style="font-size: 45px;">
          people
        </span>
      </a>
      <a href="notifications.html" class="home" style="color: black;">
        <span class="material-icons" style="font-size: 45px;">
          notifications
        </span>
      </a>
    </div>
  </nav>

  <div id="container" class="container">
    <div id="heading" class="text-center">
      <h1 id="fullname">Profile</h1>
    </div>
    <div id="picture" class="text-center">
      <img id="profilePicture" src="images/profile_image_placeholder.jpeg" alt="" />
    </div>
    <div class="text-center">
      <button id="edit-profile" type="button" class="btn btn-primary btn-lg">Edit Profile</button>
    </div>
    <div class="font">
      <label>Bio: </label>
      <p id="bio"></p>
    </div>
    <div class="font">
      <label>Quote: </label>
      <p id="quote"></p>
    </div>
    <div class="font">
      <label>Occupation: </label>
      <p id="occupation"></p>
    </div>
    <div class="font">
      <label>Field of study</label>
      <p id="fieldofstudy"></p>
    </div>
    <div class="font">
      <label>Nationality: </label>
      <p id="nationality"></p>
    </div>
    <div class="font">
      <label>Languages: </label>
      <p id="languages"></p>
    </div>
    <div id="hobbiesActivities" class="font">
      <label>Hobbies: </label>
      <p id="hobbies"></p>
    </div>
    <div class="font">
      <label>Volunteer: </label>
      <p id="volunteer"></p>
    </div>
  </div>


  <!----------------------------------------------->
  <!-- JS: Boostrap, Firebase, API related, add Jquery-->
  <!----------------------------------------------->
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.0-beta2/dist/js/bootstrap.bundle.min.js"
    integrity="sha384-b5kHyXgcpbZJO/tY9Ul7kGkf1S0CWuKcCD38l8YkeH8z8QjE0GmW1gYU5S9FOnJ0" crossorigin="anonymous">
  </script>

  <script src="https://www.gstatic.com/firebasejs/ui/6.0.0/firebase-ui-auth.js"></script>
  <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
  <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-auth.js"></script>
  <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-firestore.js"></script>
  <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-database.js"></script>
  <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-storage.js"></script>

  <!-- Link to the api keys for your firebase project -->
  <script src="scripts/firebaseAPI.js"></script>

  <script>
    function insertData() {
      firebase.auth().onAuthStateChanged(user => {
        // Check if user is signed in:
        if (user) {
          // Do something for the current logged-in user here: 
          console.log("Current User: " + user.uid);
          getUserDoc(user.uid);
        } else {
          document.getElementById("name-goes-here").innerText = "Nobody";
        }
      });
    }
    async function getUserDoc(userId) {
      const userRef = db.collection('userdata').doc(userId);
      const doc = await userRef.get();
      if (!doc.exists) {
        console.log('No such document!');
      } else {
        const data = doc.data();
        document.getElementById("fullname").innerText = data.fullname;
        document.getElementById("quote").innerText = data.quote;
        document.getElementById("bio").innerText = data.bio;
        document.getElementById("occupation").innerText = data.occupation;
        document.getElementById("fieldofstudy").innerText = data.fieldofstudy;
        document.getElementById("nationality").innerText = data.nationality;
        document.getElementById("languages").innerText = data.languages;
        document.getElementById("volunteer").innerText = data.volunteer;
        document.getElementById("hobbies").innerText = data.hobbies;
        firebase.app().storage().ref("users").child(userId + "/profile.jpg").getDownloadURL().then(imgUrl => {
          document.getElementById("profilePicture").src = imgUrl;
        }).catch(function (error) {
          console.log("No profile picture found so using default picture");
        });
      }
    }

    insertData();
    document.getElementById("edit-profile").addEventListener("click", function (e) {
      window.location.assign("editprofile.html");
    }, false);
  </script>
</body>

</html>